/* --- Core Reset & Setup --- */
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    background: #1a0b1c; /* Deep purple/black void */
    font-family: 'Montserrat', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    perspective: 1200px; /* Global 3D perspective */
}

/* --- Lighting & Atmosphere --- */
.room-vignette {
    position: fixed; inset: 0;
    background: radial-gradient(circle at 50% 50%, transparent 20%, #000 100%);
    pointer-events: none;
    z-index: 500;
    opacity: 0.6;
}

/* --- Realistic Physics Curtains --- */
.curtain-container {
    position: fixed; inset: 0;
    pointer-events: none;
    z-index: 1000;
    display: flex;
}

.curtain-panel {
    width: 50%; height: 100%;
    background: #800000;
    position: relative;
    transform-origin: top center;
    box-shadow: 10px 0 30px rgba(0,0,0,0.8);
    display: flex;
    /* Rich Velvet Gradient */
    background: linear-gradient(90deg, 
        #5a0000 0%, #800000 20%, #a00000 50%, 
        #800000 80%, #400000 100%);
    
    /* The Lashing Animation */
    animation-duration: 2.5s;
    animation-timing-function: cubic-bezier(0.22, 1, 0.36, 1); /* Quick snap, slow settle */
    animation-fill-mode: forwards;
    animation-delay: 0.5s;
}

.curtain-panel.left {
    transform-origin: top left;
    animation-name: lashOpenLeft;
}
.curtain-panel.right {
    transform-origin: top right;
    animation-name: lashOpenRight;
}

/* Realistic Folds */
.fold {
    flex: 1;
    height: 100%;
    background: linear-gradient(90deg, rgba(0,0,0,0.3), transparent 40%, rgba(255,255,255,0.1) 50%, rgba(0,0,0,0.3));
}

@keyframes lashOpenLeft {
    0% { transform: scaleX(1) skewX(0); }
    40% { transform: scaleX(0.2) skewX(10deg); } /* The "Lash" */
    60% { transform: scaleX(0.15) skewX(-5deg); } /* Bounce */
    100% { transform: scaleX(0) skewX(0); }
}
@keyframes lashOpenRight {
    0% { transform: scaleX(1) skewX(0); }
    40% { transform: scaleX(0.2) skewX(-10deg); }
    60% { transform: scaleX(0.15) skewX(5deg); }
    100% { transform: scaleX(0) skewX(0); }
}

/* --- The 3D Stage --- */
.stage-container {
    position: relative;
    width: 100%; height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    transform-style: preserve-3d;
}

/* Wood Table */
.table-surface {
    position: absolute;
    bottom: -15%;
    width: 120vw; height: 50vh;
    background: #3e2723;
    transform: rotateX(15deg); /* Perspective tilt */
    box-shadow: 0 -20px 50px rgba(0,0,0,0.5);
    z-index: 10;
    display: flex; justify-content: center;
    /* Animation */
    opacity: 0;
    animation: fadeTable 1s 1s forwards;
}
@keyframes fadeTable { to { opacity: 1; } }

.wood-grain {
    width: 100%; height: 100%;
    background-image: repeating-linear-gradient(45deg, rgba(255,255,255,0.02) 0px, transparent 2px, rgba(0,0,0,0.1) 5px);
    opacity: 0.8;
}

/* --- Cake Physics Drop --- */
.cake-assembly {
    position: relative;
    width: 500px; height: 400px;
    z-index: 20;
    transform-style: preserve-3d;
    
    /* Drop Animation */
    animation: cakeDropReal 1.5s 2s cubic-bezier(0.175, 0.885, 0.32, 1.275) backwards;
}

@keyframes cakeDropReal {
    0% { transform: translateY(-150vh) scale(0.8) rotateX(10deg); opacity: 0; }
    60% { transform: translateY(40px) scaleX(1.1) scaleY(0.9); } /* Squash */
    80% { transform: translateY(-10px) scaleX(0.95) scaleY(1.05); } /* Stretch */
    100% { transform: translateY(0) scale(1); opacity: 1; }
}

/* Porcelain Plate */
.plate-body {
    position: absolute;
    bottom: 0; left: 50%;
    transform: translateX(-50%) rotateX(60deg); /* Flattened 3D circle */
    width: 550px; height: 550px;
    background: radial-gradient(circle at 30% 30%, #e0f7fa, #00acc1);
    border-radius: 50%;
    border: 8px solid #fff;
    box-shadow: 0 20px 40px rgba(0,0,0,0.4), inset 0 0 50px rgba(0,0,0,0.2);
    z-index: 1;
}
.plate-reflection {
    position: absolute; top: 10%; right: 20%;
    width: 100px; height: 50px;
    background: rgba(255,255,255,0.6);
    border-radius: 50%;
    transform: rotate(-45deg);
    filter: blur(10px);
}
.plate-shadow {
    position: absolute;
    bottom: -20px; left: 50%;
    width: 500px; height: 150px;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.6);
    border-radius: 50%;
    filter: blur(20px);
    z-index: 0;
}

/* --- Cake Body --- */
.cake-body {
    position: absolute;
    bottom: 100px; left: 50%;
    width: 400px; height: 200px;
    transform: translateX(-50%);
    z-index: 5;
    perspective: 800px;
}

/* Layers */
.layer-base {
    position: absolute;
    bottom: 0; width: 100%; height: 100px;
    background: #4e342e;
    border-radius: 50% 50% 50% 50% / 0% 0% 25% 25%;
    box-shadow: inset -10px -5px 20px rgba(0,0,0,0.5);
    overflow: hidden;
}
.sponge-texture {
    width: 100%; height: 100%;
    background-image: radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px);
    background-size: 4px 4px;
    opacity: 0.3;
}

.layer-cream {
    position: absolute;
    top: 20px; width: 100%; height: 140px;
    background: linear-gradient(to right, #fff9c4, #fff176, #fff9c4);
    border-radius: 50%;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

/* Realistic Drips */
.drips-container { position: absolute; top: 50%; width: 100%; height: 100%; pointer-events: none; }
.drip {
    position: absolute; top: 0;
    background: #fff9c4;
    border-radius: 0 0 20px 20px;
    box-shadow: 1px 2px 2px rgba(0,0,0,0.1);
}
.d1 { left: 10%; width: 30px; height: 60px; }
.d2 { left: 30%; width: 40px; height: 40px; }
.d3 { left: 50%; width: 35px; height: 70px; }
.d4 { left: 70%; width: 25px; height: 50px; }
.d5 { left: 90%; width: 30px; height: 40px; }

/* 3D Gold Text */
.name-plaque {
    position: absolute; top: 60px; width: 100%;
    text-align: center;
    transform: rotateX(5deg);
}
.name-plaque h1 {
    font-family: 'Great Vibes', cursive;
    font-size: 3.5rem;
    color: #ffd700; /* Gold */
    text-shadow: 
        0 1px 0 #bf9000,
        0 2px 0 #bf9000,
        0 5px 10px rgba(0,0,0,0.4);
    letter-spacing: 2px;
}

/* Top Surface */
.layer-top {
    position: absolute; top: 20px; width: 100%; height: 110px;
    background: #fffdeb;
    border-radius: 50%;
    /* Create slight indentation for frosting rim */
    box-shadow: inset 0 0 20px rgba(194, 169, 105, 0.4); 
    transform: rotateX(50deg); /* Tilt top */
}
.frosting-rim {
    position: absolute; inset: 0;
    border-radius: 50%;
    border: 8px solid #fff59d;
    filter: blur(1px);
}
.icing-texture {
    position: absolute; inset: 10px;
    background-image: radial-gradient(rgba(0,0,0,0.05) 2px, transparent 2px);
    background-size: 15px 15px;
    opacity: 0.5;
}

/* --- Realistic Decorations --- */
.candle {
    position: absolute;
    width: 8px; height: 60px;
    border-radius: 2px;
    /* Subsurface scattering gradient */
    background: linear-gradient(90deg, rgba(255,255,255,0.4), var(--c-base), rgba(0,0,0,0.1));
    box-shadow: 2px 5px 5px rgba(0,0,0,0.3);
    transform-origin: bottom center;
}
.wick {
    position: absolute; top: -6px; left: 50%;
    width: 2px; height: 6px; background: #333;
    transform: translateX(-50%);
}
.flame {
    position: absolute; top: -25px; left: 50%;
    width: 10px; height: 25px;
    transform: translateX(-50%);
    border-radius: 50% 50% 30% 30%;
    background: radial-gradient(ellipse at 50% 80%, white 10%, yellow 40%, orange 80%, transparent 100%);
    filter: blur(1px);
    mix-blend-mode: screen;
    box-shadow: 0 0 20px rgba(255, 200, 0, 0.6), 0 0 40px rgba(255, 100, 0, 0.3);
    animation: realFlicker 0.1s infinite alternate;
}
.flame.out { display: none; }

@keyframes realFlicker {
    0% { transform: translateX(-50%) scale(1) skewX(1deg); opacity: 1; }
    100% { transform: translateX(-50%) scale(0.95, 1.05) skewX(-1deg); opacity: 0.9; }
}

.treat {
    position: absolute;
    width: 25px; height: 25px;
    border-radius: 50%;
    box-shadow: 1px 2px 4px rgba(0,0,0,0.3);
}
.truffle {
    background: radial-gradient(circle at 30% 30%, #8d6e63, #3e2723);
}
.macaron {
    height: 15px; border-radius: 40%;
    background: var(--m-col);
    border-bottom: 2px solid rgba(0,0,0,0.1);
}

/* --- Smoke --- */
.smoke {
    position: absolute; top: -40px; left: 50%;
    width: 10px; height: 40px;
    background: linear-gradient(to top, rgba(150,150,150,0.8), transparent);
    filter: blur(5px);
    transform-origin: bottom;
    animation: smokeWisp 1.5s forwards ease-out;
}
@keyframes smokeWisp {
    0% { transform: translateX(-50%) scale(1); opacity: 0.8; }
    100% { transform: translateX(-50%) translateY(-50px) scale(3) rotate(20deg); opacity: 0; }
}

/* --- UI Overlays --- */
#ui-layer {
    position: fixed; top: 0; width: 100%;
    z-index: 2000;
    pointer-events: none;
}
#unlock-audio-layer {
    position: absolute; top: 20%; width: 100%;
    text-align: center;
    pointer-events: auto;
    cursor: pointer;
}
.tap-hint-box {
    display: inline-block;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    color: #fff;
    padding: 15px 30px;
    border-radius: 50px;
    font-size: 1.2rem;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    animation: floatHint 3s infinite ease-in-out;
}
@keyframes floatHint { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }

#mic-indicator {
    position: absolute; top: 20px; right: 20px;
    background: rgba(0,0,0,0.6);
    padding: 10px; border-radius: 30px;
    display: flex; gap: 10px; align-items: center;
    backdrop-filter: blur(5px);
}
#mic-indicator.hidden { opacity: 0; }
.bar-container { width: 80px; height: 6px; background: rgba(255,255,255,0.2); border-radius: 3px; }
#mic-level-bar { width: 0%; height: 100%; background: #00e676; box-shadow: 0 0 10px #00e676; transition: width 0.05s; }

/* Win Card */
#win-message {
    position: fixed; inset: 0;
    display: flex; justify-content: center; align-items: center;
    background: rgba(0,0,0,0.8);
    z-index: 3000;
    animation: fadeIn 1s;
}
#win-message.hidden { display: none; }
.card {
    background: white; padding: 40px; border-radius: 20px;
    text-align: center;
    box-shadow: 0 0 50px rgba(255,215,0,0.5);
}
.card h2 { color: #d81b60; font-family: 'Great Vibes'; font-size: 4rem; margin-bottom: 10px; }
.card button {
    margin-top: 20px; padding: 10px 30px;
    background: #d81b60; color: white; border: none;
    font-size: 1.2rem; border-radius: 50px; cursor: pointer;
}

#confetti-canvas { position: fixed; inset: 0; pointer-events: none; z-index: 2500; }

/* Balloons */
.real-balloon {
    position: absolute; width: 80px; height: 100px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), var(--bg) 60%);
    box-shadow: 0 20px 30px rgba(0,0,0,0.4);
    opacity: 0.9;
}
.red { --bg: #d32f2f; bottom: 20px; left: 10%; animation: floatB 5s infinite; }
.gold { --bg: #fbc02d; bottom: 50px; left: 50%; animation: floatB 6s infinite 1s; }
.blue { --bg: #1976d2; bottom: 30px; right: 10%; animation: floatB 7s infinite 0.5s; }

@keyframes floatB { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-30px)} }