/* --- GLOBAL --- */
body {
    background: #050203; 
    margin: 0;
    overflow: hidden;
    font-family: 'Montserrat', sans-serif;
}

/* --- ROOM PERSPECTIVE --- */
.perspective-1000 { perspective: 1000px; }

/* --- CURTAINS --- */
.curtain-rod {
    position: absolute; top: -10px; left: -20px; right: -20px; height: 15px; 
    background: linear-gradient(to bottom, #5d4037, #3e2723);
    border-radius: 10px; z-index: 20;
    box-shadow: 0 5px 10px rgba(0,0,0,0.5);
}
.curtain {
    position: absolute; top: 0; height: 100%; width: 140px;
    background: repeating-linear-gradient(90deg, #b71c1c, #880e4f 10px, #b71c1c 20px);
    box-shadow: 5px 0 15px rgba(0,0,0,0.5);
    z-index: 10;
}
.left-curtain {
    left: -20px;
    border-radius: 0 0 80px 0;
    transform-origin: top left;
    transform: rotate(2deg);
    border-right: 2px solid #560027;
}
.right-curtain {
    right: -20px;
    border-radius: 0 0 0 80px;
    transform-origin: top right;
    transform: rotate(-2deg);
    border-left: 2px solid #560027;
}
.curtain-valance {
    position: absolute; top: -5px; left: -20px; right: -20px; height: 70px;
    background: repeating-linear-gradient(90deg, #c62828, #880e4f 20px, #c62828 40px);
    border-radius: 0 0 50% 50% / 0 0 100% 100%;
    z-index: 15;
    box-shadow: 0 5px 15px rgba(0,0,0,0.4);
    border-bottom: 4px solid #ffd700;
}

/* --- BANNERS --- */
.banner-string {
    display: flex; gap: 8px; padding: 10px;
    border-top: 1px solid rgba(255,255,255,0.4);
    border-radius: 50% 50% 0 0 / 20px 20px 0 0;
    justify-content: center;
}
.banner-flag {
    width: 28px; height: 38px;
    background: linear-gradient(to bottom, #ffca28, #ff6f00);
    clip-path: polygon(0 0, 100% 0, 50% 100%);
    display: flex; justify-content: center; padding-top: 2px;
    font-weight: bold; color: #3e2723; font-size: 1rem;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    animation: sway 3s ease-in-out infinite alternate;
}
.banner-flag.alt { background: linear-gradient(to bottom, #ec407a, #ad1457); color: white; animation-delay: 1s; }
@keyframes sway { from { transform: rotate(5deg); } to { transform: rotate(-5deg); } }

/* --- FAIRY LIGHTS --- */
.light-bulb {
    position: absolute; top: 15px;
    width: 10px; height: 10px; border-radius: 50%;
    animation: glow 1.5s infinite alternate;
}
.light-bulb::before { content:''; position: absolute; top: -15px; left: 4px; width: 2px; height: 15px; background: #555; }
.light-bulb.red { background: #ff1744; box-shadow: 0 0 10px #ff1744; }
.light-bulb.yellow { background: #ffeb3b; box-shadow: 0 0 10px #ffeb3b; animation-delay: 0.3s; }
.light-bulb.blue { background: #2979ff; box-shadow: 0 0 10px #2979ff; animation-delay: 0.6s; }
.light-bulb.green { background: #00e676; box-shadow: 0 0 10px #00e676; animation-delay: 0.9s; }
@keyframes glow { from { opacity: 0.4; box-shadow: 0 0 5px currentColor; } to { opacity: 1; box-shadow: 0 0 15px currentColor; } }

/* --- TABLE SURFACE --- */
.wood-table-surface {
    position: absolute;
    top: 50%; left: 50%;
    width: 1000px; height: 1000px;
    border-radius: 50%;
    /* Richer wood texture */
    background: #281510 url('https://www.transparenttextures.com/patterns/wood-pattern.png');
    background-size: 300px;
    transform: translate(-50%, -50%) translateZ(-50px); 
    box-shadow: 0 50px 100px rgba(0,0,0,0.9), inset 0 0 150px rgba(0,0,0,0.8);
    border: 15px solid #1a0b08;
}

.table-reflection {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 600px; height: 600px;
    background: radial-gradient(rgba(255,255,255,0.08), transparent 60%);
    filter: blur(40px);
    opacity: 0.8;
    animation: shimmer 5s infinite ease-in-out;
}
@keyframes shimmer { 0%, 100% { opacity: 0.6; transform: translate(-50%, -50%) scale(1); } 50% { opacity: 0.9; transform: translate(-50%, -50%) scale(1.05); } }

/* --- STANDALONE CANDLE --- */
/* Facing camera from rotateX(60deg) scene means we reverse rotateX(-60deg) */
.standalone-candle-container {
    position: relative; width: 40px; height: 120px;
    transform: rotateX(-60deg); /* Stand up straight */
    transform-style: preserve-3d;
}
.candlestick-base {
    position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
    width: 60px; height: 15px; background: linear-gradient(to right, #DAA520, #FFD700, #DAA520);
    border-radius: 50%; box-shadow: 0 5px 10px rgba(0,0,0,0.5);
}
.candlestick-stem {
    position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
    width: 10px; height: 60px; background: linear-gradient(to right, #B8860B, #FFD700, #B8860B);
}
.candlestick-cup {
    position: absolute; bottom: 65px; left: 50%; transform: translateX(-50%);
    width: 30px; height: 10px; background: linear-gradient(to right, #DAA520, #FFD700, #DAA520);
    border-radius: 50%;
}
.wax-candle {
    position: absolute; bottom: 70px; left: 50%; transform: translateX(-50%);
    width: 16px; height: 50px; background: linear-gradient(to right, #ddd, #fff, #ddd);
    border-radius: 2px;
}
.eternal-wick {
    position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
    width: 2px; height: 5px; background: #333;
}
.eternal-flame {
    position: absolute; bottom: calc(100% + 5px); left: 50%; transform: translateX(-50%);
    width: 14px; height: 30px;
}
.flame-part {
    position: absolute; inset: 0; background: radial-gradient(ellipse at bottom, #fff 10%, #ffeb3b 40%, #ff5722 80%, transparent 100%);
    border-radius: 50% 50% 20% 20%; filter: blur(1px); animation: flicker 0.15s infinite alternate;
}

/* --- NEW CAKE ARCHITECTURE (2.5D) --- */
.cake-assembly {
    position: relative; width: 340px; height: 340px; transform-style: preserve-3d;
    margin: 0 auto; transform: translateY(-40px);
}
.plate {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) translateZ(0px);
    width: 140%; height: 140%; border-radius: 50%; background: #fdfdfd;
    box-shadow: 0 15px 40px rgba(0,0,0,0.6), inset 0 0 30px rgba(0,0,0,0.05); border: 1px solid #ddd;
}
.plate-inner { position: absolute; inset: 15px; border-radius: 50%; border: 6px solid #FFC107; box-shadow: 0 0 10px rgba(255,193,7,0.3); }

/* Tier Styles */
.cake-tier { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); transform-style: preserve-3d; }

/* Base Tier */
.base-tier { width: 100%; height: 100%; transform: translate(-50%, -50%) translateZ(20px); }
.base-tier .tier-body {
    /* 2.5D Side Wall Trick: Face the camera, curve the bottom */
    position: absolute; top: 50%; left: 50%;
    width: 100%; height: 80px; /* Height of tier */
    background: linear-gradient(to right, #3E2723, #5D4037 40%, #795548 50%, #5D4037 60%, #3E2723);
    border-radius: 0 0 50% 50% / 0 0 30px 30px; /* Curved bottom */
    transform: translate(-50%, -50%) rotateX(-60deg) translateY(40px); /* Stand up and shift down */
    box-shadow: 0 10px 20px rgba(0,0,0,0.5);
}
/* Top surface of Base Tier */
.base-tier .tier-top {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%;
    background: radial-gradient(circle, #5D4037 30%, #3E2723 100%);
    transform: translateZ(40px); /* Sits on top of the "body" height roughly */
    border: 1px solid #3E2723;
}

/* Top Tier */
.top-tier { width: 70%; height: 70%; transform: translate(-50%, -50%) translateZ(60px); } /* Base(20) + Body(40) = 60 */
.top-tier .tier-body {
    position: absolute; top: 50%; left: 50%;
    width: 100%; height: 70px;
    background: linear-gradient(to right, #c2185b, #e91e63 40%, #f06292 50%, #e91e63 60%, #c2185b);
    border-radius: 0 0 50% 50% / 0 0 25px 25px;
    transform: translate(-50%, -50%) rotateX(-60deg) translateY(35px);
    box-shadow: 0 10px 15px rgba(0,0,0,0.3);
}
.top-tier .tier-top {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #fff3e0, #ffe0b2);
    transform: translateZ(35px);
    box-shadow: inset 0 0 15px rgba(0,0,0,0.1); border: 1px solid #ffcc80;
}
.frosting-rim {
    position: absolute; inset: -5px; border-radius: 50%;
    border: 5px dashed #fff; opacity: 0.8;
}

/* --- BILLBOARDS ON CAKE (Standing Up) --- */
/* Rotate X -60deg to counteract Scene rotation */
.cake-writing {
    position: absolute; top: 50%; left: 50%; 
    transform: translate(-50%, -50%) rotateX(-60deg) translateY(-40px) translateZ(50px);
    font-family: 'Great Vibes', cursive; font-size: 3.5rem; color: #ad1457; 
    text-shadow: 2px 2px 0px rgba(255,255,255,0.8); white-space: nowrap; pointer-events: none;
}

.panda-container { position: absolute; top: 25%; left: 50%; transform: translate(-50%, -50%) rotateX(-60deg) translateZ(20px); z-index: 50; }
.panda-body { width: 50px; height: 44px; background: #fff; border-radius: 45% 45% 40% 40%; box-shadow: 0 5px 10px rgba(0,0,0,0.2); position: relative; border: 1px solid #eee; animation: bob 3s ease-in-out infinite; }
/* Panda details same as before */
.ear { position: absolute; top: -8px; width: 16px; height: 16px; background: #222; border-radius: 50%; z-index: -1; }
.ear.left { left: 0; } .ear.right { right: 0; }
.face { position: relative; width: 100%; height: 100%; }
.eye { position: absolute; top: 12px; width: 12px; height: 12px; background: #222; border-radius: 50%; overflow: hidden; }
.eye.left { left: 10px; } .eye.right { right: 10px; }
.pupil { width: 4px; height: 4px; background: #fff; border-radius: 50%; margin: 2px; animation: blink 4s infinite; }
.nose { position: absolute; top: 24px; left: 50%; transform: translateX(-50%); width: 8px; height: 5px; background: #222; border-radius: 40%; }
.mouth { position: absolute; top: 30px; left: 50%; transform: translateX(-50%); width: 10px; height: 4px; border-bottom: 2px solid #222; border-radius: 50%; }
.cheek { position: absolute; top: 24px; width: 8px; height: 5px; background: #ffcdd2; border-radius: 50%; opacity: 0.6; }
.cheek.left { left: 2px; } .cheek.right { right: 2px; }

/* Candles */
.candle-wrapper { position: absolute; transform-origin: bottom center; transform: translate(-50%, 0) rotateX(-60deg); z-index: 100; }
.candle-stick { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 6px; border-radius: 2px; box-shadow: 1px 1px 3px rgba(0,0,0,0.3); }
.wick { position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); width: 2px; height: 6px; background: #333; }
.flame-3d { position: absolute; bottom: calc(100% + 6px); left: 50%; width: 10px; height: 24px; transform-style: preserve-3d; transform: translateX(-50%); transition: all 0.2s; }
.flame-plane { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(ellipse at bottom, #fff, #ffeb3b, #ff5722, transparent); border-radius: 50% 50% 20% 20%; animation: flicker 0.1s infinite alternate; }
.flame-plane:nth-child(2) { transform: rotateY(90deg); }
.flame-3d.out { transform: translateX(-50%) scale(0.1); opacity: 0; }
.candle-wrapper.extinguished .wick { animation: wick-glow 1.5s ease-out forwards; }

@keyframes flicker { 0% { opacity: 0.9; transform: scaleY(1) skewX(1deg); } 100% { opacity: 1; transform: scaleY(1.1) skewX(-1deg); } }

/* Cherries */
.cherry { transform: translate(-50%, -50%) rotateX(-50deg) !important; box-shadow: 0 5px 5px rgba(0,0,0,0.3); }

/* Other Objects */
.object-3d { position: absolute; transform-style: preserve-3d; }
.cookie { width: 30px; height: 30px; background: #d7ccc8; border-radius: 50%; position: relative; box-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
.cookie::before, .cookie::after { content: ''; position: absolute; width: 5px; height: 5px; background: #4e342e; border-radius: 50%; }
.cookie::before { top: 8px; left: 8px; } .cookie::after { bottom: 8px; right: 8px; }
.choc { width: 25px; height: 25px; background: #4e342e; box-shadow: inset 1px 1px 4px rgba(255,255,255,0.1); }
.choc.round { border-radius: 50%; } .choc.square { border-radius: 2px; }

/* Gifts */
.gift-box { position: absolute; top: 50%; left: 50%; width: 70px; height: 70px; transform-style: preserve-3d; transform: translate3d(var(--x), var(--z), 0) rotateZ(var(--rot)) rotateX(-90deg); z-index: 15; }
.gift-box::before { content: ''; position: absolute; inset: 0; background: var(--color); box-shadow: inset 0 0 20px rgba(0,0,0,0.2); transform: translateZ(40px); }
.gift-box::after { content: ''; position: absolute; top: 100%; left: 0; width: 100%; height: 40px; background-color: var(--color); filter: brightness(0.7); transform-origin: top; transform: rotateX(-90deg); }
.gift-lid { position: absolute; inset: -4px; background: rgba(255,255,255,0.1); transform: translateZ(42px); border: 1px solid rgba(255,255,255,0.2); }
.gift-ribbon { position: absolute; inset: 0; background: linear-gradient(90deg, transparent 40%, var(--ribbon) 40%, var(--ribbon) 60%, transparent 60%), linear-gradient(0deg, transparent 40%, var(--ribbon) 40%, var(--ribbon) 60%, transparent 60%); transform: translateZ(43px); }

/* Card Modal */
.book-container { perspective: 1500px; z-index: 200; }
.book { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 1s; }
.cover { position: absolute; width: 100%; height: 100%; transform-origin: left; transform-style: preserve-3d; transition: transform 1.5s cubic-bezier(0.25, 1, 0.5, 1); z-index: 10; }
.front, .back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 2px 10px 10px 2px; box-shadow: 10px 10px 30px rgba(0,0,0,0.5); }
.front { 
    background: #880e4f; 
    background-image: url('https://www.transparenttextures.com/patterns/leather.png');
    display: flex; justify-content: center; align-items: center; 
    border-left: 2px solid #560027;
}
.back { background: #fff; transform: rotateY(180deg); border-left: 1px solid #ddd; }
.page-right { 
    position: absolute; width: 98%; height: 96%; top: 2%; left: 0; 
    background: #fff; border-radius: 0 8px 8px 0; z-index: 5; 
    box-shadow: 5px 5px 15px rgba(0,0,0,0.2); 
    background: linear-gradient(to right, #e0e0e0, #fff 10%);
}
.book.open .cover { transform: rotateY(-180deg); }

/* Utils */
.balloon { position: absolute; z-index: 1; }
@keyframes bob { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
@keyframes blink { 0%, 95% { transform: scaleY(1); } 98% { transform: scaleY(0.1); } }
@keyframes float-up { 0% { transform: translateY(0) rotate(0deg); opacity: 0; } 20% { opacity: 0.8; } 100% { transform: translateY(-110vh) rotate(15deg); opacity: 0; } }
@keyframes wick-glow { 0% { background-color: #ff3d00; box-shadow: 0 0 6px #ff1744; } 100% { background-color: #222; box-shadow: none; } }
