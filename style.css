/* --- GLOBAL --- */
body {
    background: #1a0509; /* Dark room color */
    margin: 0;
    overflow: hidden;
    font-family: 'Montserrat', sans-serif;
}

/* --- ROOM PERSPECTIVE --- */
.perspective-1000 { perspective: 1000px; }

/* --- BANNERS --- */
.banner-string {
    display: flex;
    gap: 10px;
    padding: 10px;
    border-top: 2px solid rgba(255,255,255,0.3);
    border-radius: 50% 50% 0 0 / 20px 20px 0 0; /* Curved String */
    transform: rotate(-2deg);
    width: 400px;
    justify-content: center;
}
.banner-flag {
    width: 30px; height: 40px;
    background: #ffc107;
    clip-path: polygon(0 0, 100% 0, 50% 100%);
    display: flex; justify-content: center; align-items: flex-start;
    padding-top: 5px;
    font-weight: bold; color: #d32f2f;
    font-size: 1.2rem;
    animation: sway 3s ease-in-out infinite alternate;
}
.banner-flag.alt { background: #ec407a; color: white; animation-delay: 1s; }
@keyframes sway { from { transform: rotate(5deg); } to { transform: rotate(-5deg); } }

/* --- FAIRY LIGHTS --- */
.light-bulb {
    width: 12px; height: 12px;
    border-radius: 50%;
    margin-top: 10px;
    position: relative;
    animation: glow 1s infinite alternate;
}
.light-bulb::before { content:''; position: absolute; top: -10px; left: 50%; width: 1px; height: 10px; bg: #444; }
.light-bulb.red { background: #ff1744; box-shadow: 0 0 10px #ff1744; }
.light-bulb.yellow { background: #ffeb3b; box-shadow: 0 0 10px #ffeb3b; animation-delay: 0.3s; }
.light-bulb.blue { background: #2979ff; box-shadow: 0 0 10px #2979ff; animation-delay: 0.6s; }
.light-bulb.green { background: #00e676; box-shadow: 0 0 10px #00e676; animation-delay: 0.9s; }
@keyframes glow { from { opacity: 0.5; transform: scale(0.9); } to { opacity: 1; transform: scale(1.1); } }

/* --- FOOD ITEMS --- */
/* Cookies */
.cookie {
    width: 28px; height: 28px;
    background: #d7ccc8;
    border-radius: 50%;
    position: relative;
    box-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}
.cookie::before, .cookie::after {
    content: ''; position: absolute; width: 4px; height: 4px; background: #3e2723; border-radius: 50%;
}
.cookie::before { top: 6px; left: 8px; }
.cookie::after { bottom: 8px; right: 6px; }

/* Chocolates */
.choc { width: 20px; height: 20px; background: #3e2723; box-shadow: inset 1px 1px 3px rgba(255,255,255,0.2); }
.choc.round { border-radius: 50%; }
.choc.square { border-radius: 2px; }

/* --- TABLE SURFACE --- */
/* This is the flat surface. The parent scene rotates 75deg so this looks like a floor/tabletop */
.wood-table-surface {
    position: absolute;
    top: 50%; left: 50%;
    width: 1200px; 
    height: 1200px;
    border-radius: 50%;
    background: #3e2723 url('https://www.transparenttextures.com/patterns/wood-pattern.png');
    /* Slightly lower Z so items sit on top */
    transform: translate(-50%, -50%) translateZ(-50px); 
    box-shadow: 0 50px 100px rgba(0,0,0,0.8), inset 0 0 100px rgba(0,0,0,0.9);
    border: 20px solid #281a16;
}

.table-reflection {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 600px; height: 600px;
    background: radial-gradient(rgba(255,255,255,0.05), transparent 70%);
    filter: blur(50px);
}

/* --- CAKE ASSEMBLY --- */
.cake-assembly {
    position: relative; width: 320px; height: 320px; transform-style: preserve-3d;
    margin: 0 auto;
}
.plate {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) translateZ(-5px);
    width: 140%; height: 140%; border-radius: 50%; background: #fff;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5), inset 0 0 20px rgba(0,0,0,0.1); border: 2px solid #eee;
}
.plate-inner { position: absolute; inset: 15px; border-radius: 50%; border: 4px solid #FFC107; box-shadow: 0 0 15px rgba(255,193,7,0.4); }

/* --- CAKE LAYERS (THICKNESS) --- */
.cake-layer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); transform-style: preserve-3d; }
.layer-side, .layer-top { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%; }

/* Base Layer (Chocolate) - 70px thick */
.base-layer { width: 100%; height: 100%; transform: translate(-50%, -50%) translateZ(20px); }
.base-layer .layer-side {
    background: linear-gradient(to right, #3E2723, #4E342E 25%, #5D4037 50%, #4E342E 75%, #3E2723);
    /* Thickness via translateZ gap */
    transform: translateZ(-70px); 
    box-shadow: 0 20px 40px rgba(0,0,0,0.6);
}
/* Side visual hack to connect top and bottom (CSS 3D limitation handled by thick shadow or duplicating layers, 
   but for simple cylinder we use the wall pushed back. Here we use a pseudo element for "wall" thickness appearance) */
.base-layer::before {
    content:''; position: absolute; top:0; left:0; width:100%; height:100%; border-radius: 50%;
    background: #3E2723; transform: translateZ(-35px) scale(0.98); 
    box-shadow: 0 0 20px #3E2723;
}
.base-layer .layer-top { background: radial-gradient(circle, #5D4037 20%, #3E2723 100%); transform: translateZ(0px); border: 1px solid #3E2723; }

/* Top Layer (Pink) - 60px thick */
.top-layer { width: 75%; height: 75%; transform: translate(-50%, -50%) translateZ(90px); } /* Base(20) + 70 = 90 start */
.top-layer .layer-side {
    background: linear-gradient(to right, #ec407a, #f48fb1 25%, #f8bbd0 50%, #f48fb1 75%, #ec407a);
    transform: translateZ(-60px);
}
.top-layer::before {
    content:''; position: absolute; top:0; left:0; width:100%; height:100%; border-radius: 50%;
    background: #ec407a; transform: translateZ(-30px) scale(0.98);
}
.top-layer .layer-top { background: radial-gradient(circle at 30% 30%, #fff3e0 0%, #ffcc80 100%); transform: translateZ(0px); box-shadow: inset 0 0 20px rgba(0,0,0,0.1); border: 1px solid #ffb74d; }

.frosting-drip { position: absolute; top: -5px; left: 0; width: 100%; height: 25px; background: repeating-linear-gradient(45deg, rgba(255,255,255,0.4), rgba(255,255,255,0.4) 10px, transparent 10px, transparent 20px); opacity: 0.6; border-radius: 50%; filter: blur(1px); }

/* --- BILLBOARDS (Facing Camera) --- */
/* Since Scene is rotated X 75deg, we rotate these -75deg to stand up straight */

.cake-writing {
    position: absolute; top: 50%; left: 50%; 
    transform: translate(-50%, -50%) rotateX(-75deg) translateY(-60px) translateZ(30px);
    font-family: 'Great Vibes', cursive; font-size: 3.5rem; color: #c2185b; 
    text-shadow: 1px 1px 0 rgba(255,255,255,0.6); white-space: nowrap; pointer-events: none;
}

/* Panda */
.panda-container { position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%) rotateX(-75deg) translateY(-20px); z-index: 50; }
.panda-body { width: 60px; height: 50px; background: #fff; border-radius: 45% 45% 40% 40%; box-shadow: 0 5px 15px rgba(0,0,0,0.2); position: relative; border: 1px solid #f5f5f5; animation: bob 3s ease-in-out infinite; }
.ear { position: absolute; top: -10px; width: 20px; height: 20px; background: #222; border-radius: 50%; z-index: -1; }
.ear.left { left: 0; } .ear.right { right: 0; }
.face { position: relative; width: 100%; height: 100%; }
.eye { position: absolute; top: 15px; width: 16px; height: 16px; background: #222; border-radius: 50%; overflow: hidden; }
.eye.left { left: 10px; } .eye.right { right: 10px; }
.pupil { width: 6px; height: 6px; background: #fff; border-radius: 50%; margin: 3px; animation: blink 4s infinite; }
.nose { position: absolute; top: 28px; left: 50%; transform: translateX(-50%); width: 10px; height: 6px; background: #222; border-radius: 40%; }
.mouth { position: absolute; top: 36px; left: 50%; transform: translateX(-50%); width: 12px; height: 5px; border-bottom: 2px solid #222; border-radius: 50%; }
.cheek { position: absolute; top: 28px; width: 10px; height: 6px; background: #ffcdd2; border-radius: 50%; opacity: 0.6; }
.cheek.left { left: 2px; } .cheek.right { right: 2px; }

/* Candles */
.candle-wrapper { position: absolute; transform-origin: bottom center; transform: translate(-50%, 0) rotateX(-75deg); z-index: 100; }
.candle-stick { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 8px; border-radius: 2px; box-shadow: 1px 1px 4px rgba(0,0,0,0.3); }
.candle-stick::before { content: ''; position: absolute; inset: 0; background: repeating-linear-gradient(45deg, rgba(255,255,255,0.4) 0, rgba(255,255,255,0.4) 3px, transparent 3px, transparent 6px); }
.wick { position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); width: 2px; height: 7px; background: #333; transition: background-color 0.2s; }
.flame-3d { position: absolute; bottom: calc(100% + 7px); left: 50%; width: 14px; height: 32px; transform-style: preserve-3d; transform: translateX(-50%); transition: all 0.2s ease-out; }
.flame-plane { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(ellipse at bottom, #fff 10%, #ffeb3b 40%, #ff9800 80%, transparent 100%); border-radius: 50% 50% 20% 20%; box-shadow: 0 0 15px #ff9800; animation: flicker 0.1s infinite alternate; }
.flame-plane:nth-child(2) { transform: rotateY(90deg); }
.flame-3d.out { transform: translateX(-50%) scale(0.1); opacity: 0; }
.candle-wrapper.extinguished .wick { animation: wick-glow 1.5s ease-out forwards; }

/* Cherries - Tilted to face camera slightly */
.cherry {
    transform: translate(-50%, -50%) rotateX(-60deg) !important;
}

/* Smoke */
.smoke { position: absolute; bottom: calc(100% + 15px); left: 50%; width: 8px; height: 8px; background: rgba(255,255,255,0.5); border-radius: 50%; filter: blur(3px); animation: smoke-rise 2s ease-out forwards; }
@keyframes smoke-rise { 0% { transform: translate(-50%, 0) scale(1); opacity: 0.6; } 100% { transform: translate(-50%, -80px) scale(4); opacity: 0; } }

/* Gifts */
.gift-box { position: absolute; top: 50%; left: 50%; width: 60px; height: 60px; transform-style: preserve-3d; transform: translate3d(var(--x), var(--z), 0) rotateZ(var(--rot)) rotateX(-90deg); z-index: 15; }
.gift-box::before { content: ''; position: absolute; inset: 0; background: var(--color); box-shadow: inset 0 0 15px rgba(0,0,0,0.3); transform: translateZ(40px); }
.gift-box::after { content: ''; position: absolute; top: 100%; left: 0; width: 100%; height: 40px; background-color: var(--color); filter: brightness(0.7); transform-origin: top; transform: rotateX(-90deg); }
.gift-lid { position: absolute; inset: -3px; background: rgba(255,255,255,0.15); transform: translateZ(42px); border: 1px solid rgba(255,255,255,0.3); }
.gift-ribbon { position: absolute; inset: 0; background: linear-gradient(90deg, transparent 40%, #FFD700 40%, #FFD700 60%, transparent 60%), linear-gradient(0deg, transparent 40%, #FFD700 40%, #FFD700 60%, transparent 60%); transform: translateZ(43px); }

/* Card Modal Styles */
.book-container { perspective: 1500px; z-index: 200; }
.book { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 1s; }
.cover { position: absolute; width: 100%; height: 100%; transform-origin: left; transform-style: preserve-3d; transition: transform 1.5s cubic-bezier(0.25, 1, 0.5, 1); z-index: 10; }
.front, .back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 4px 12px 12px 4px; box-shadow: 5px 5px 15px rgba(0,0,0,0.3); }
.front { background-color: #c2185b; background: linear-gradient(135deg, #e91e63, #ad1457); background-image: url('https://www.transparenttextures.com/patterns/leather.png'), linear-gradient(135deg, #e91e63, #ad1457); background-blend-mode: overlay; display: flex; justify-content: center; align-items: center; }
.back { background: #fff; transform: rotateY(180deg); }
.page-right { position: absolute; width: 100%; height: 100%; background: #fff; border-radius: 4px 12px 12px 4px; z-index: 5; box-shadow: 5px 5px 15px rgba(0,0,0,0.3); border-left: 1px solid #ddd; background: radial-gradient(circle at left, #f5f5f5, #fff); }
.book.open .cover { transform: rotateY(-180deg); }

/* Animation Utils */
@keyframes bob { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
@keyframes blink { 0%, 95% { transform: scaleY(1); } 98% { transform: scaleY(0.1); } }
@keyframes float-up { 0% { transform: translateY(0) rotate(0deg); opacity: 0; } 20% { opacity: 0.6; } 100% { transform: translateY(-100vh) rotate(10deg); opacity: 0; } }
@keyframes wick-glow { 0% { background-color: #ff3d00; box-shadow: 0 0 6px #ff1744; } 30% { background-color: #ff9100; box-shadow: 0 0 4px #ff6d00; } 100% { background-color: #222; box-shadow: none; } }
.balloon { position: absolute; z-index: 1; }
