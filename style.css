/* --- GLOBAL --- */
body {
    background-color: #1a0b1c;
    margin: 0;
    overflow: hidden;
    font-family: 'Montserrat', sans-serif;
}

/* --- LIGHTING --- */
.spotlight {
    position: absolute;
    top: -50%;
    left: 50%;
    transform: translateX(-50%);
    width: 100vw;
    height: 100vh;
    background: radial-gradient(circle, rgba(255,230,230,0.15) 0%, rgba(0,0,0,0) 60%);
    pointer-events: none;
    z-index: 5;
}

/* --- ANIMATIONS --- */
/* Curtain Sway */
.curtain {
    animation: curtain-sway 6s ease-in-out infinite alternate;
}
@keyframes curtain-sway {
    0% { transform: rotate(0deg) scaleX(1); }
    50% { transform: rotate(1deg) scaleX(1.02); }
    100% { transform: rotate(-1deg) scaleX(1); }
}

/* --- BACKGROUND DECOR --- */
.streamer {
    position: absolute;
    top: -20px;
    width: 15px;
    height: 30px;
    background: var(--color, #f00);
    border-radius: 4px;
    animation: fall-sway var(--duration, 5s) linear infinite;
    animation-delay: var(--delay, 0s);
    opacity: 0.7;
    z-index: 1;
}

@keyframes fall-sway {
    0% { transform: translateY(-50px) rotate(0deg) translateX(0); opacity: 0; }
    10% { opacity: 1; }
    100% { transform: translateY(110vh) rotate(360deg) translateX(50px); opacity: 0; }
}

.balloon {
    position: absolute;
    bottom: -150px;
    width: 60px;
    height: 75px;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), var(--color) 40%, #000 100%);
    border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
    box-shadow: inset -5px -5px 10px rgba(0,0,0,0.3), 5px 5px 15px rgba(0,0,0,0.2);
    animation: float-up var(--duration, 10s) ease-in infinite;
    animation-delay: var(--delay, 0s);
    z-index: 2;
    opacity: 0.9;
}
.balloon::before {
    content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%);
    width: 2px; height: 40px; background: rgba(255,255,255,0.5);
}
.balloon::after {
    content: ''; position: absolute; bottom: -2px; left: 50%; transform: translateX(-50%);
    width: 10px; height: 4px; background: var(--color); border-radius: 2px;
}

@keyframes float-up {
    0% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-60vh) rotate(5deg); }
    100% { transform: translateY(-120vh) rotate(-5deg); }
}

.curtain-open-left { transform: translateX(-100%) !important; animation: none; }
.curtain-open-right { transform: translateX(100%) !important; animation: none; }

/* --- 3D CAKE STAGE (ISOMETRIC SETUP) --- */
.cake-container {
    position: relative;
    width: 400px;
    height: 400px;
    margin-top: 50px;
    perspective: 1200px;
    transform-style: preserve-3d;
    /* Rotation to see Top and Side */
    transform: rotateX(25deg); 
    z-index: 20;
}

/* --- TABLE (Glossy Wood) --- */
.wood-table {
    position: absolute;
    bottom: -40vh; left: 50%;
    transform: translateX(-50%) rotateX(20deg);
    width: 180vw; height: 100vh;
    background: radial-gradient(ellipse at center, #5D4037 0%, #3E2723 60%, #1a0b08 100%);
    border-radius: 100% 100% 0 0;
    box-shadow: inset 0 10px 30px rgba(255,255,255,0.05), inset 0 -50px 100px rgba(0,0,0,0.9);
    border-top: 4px solid rgba(255,255,255,0.1);
    z-index: 10;
    overflow: hidden;
}
.table-reflection {
    position: absolute; top: 5%; left: 50%; transform: translateX(-50%);
    width: 60%; height: 40%;
    background: radial-gradient(ellipse at center, rgba(255,255,255,0.1) 0%, transparent 70%);
    filter: blur(40px);
    border-radius: 50%;
}

/* --- PLATE --- */
.plate {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%) translateZ(-10px); /* Lower than base */
    width: 120%; height: 120%;
    z-index: 0;
    transform-style: preserve-3d;
}
.plate-inner {
    width: 100%; height: 100%;
    background: radial-gradient(circle at 30% 30%, #ffffff, #f5f5f5);
    border-radius: 50%;
    box-shadow: 0 30px 60px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.1);
    border: 8px solid #fff;
    position: relative;
}
.plate-inner::before {
    content: ''; position: absolute; inset: -4px;
    border: 4px solid #FFD700; border-radius: 50%;
    box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
}

/* --- KNIFE --- */
.knife-container {
    position: absolute;
    bottom: -10%; right: -20%;
    width: 240px; z-index: 10;
    filter: drop-shadow(5px 10px 10px rgba(0,0,0,0.5));
    transition: transform 0.5s;
    transform: rotateX(-20deg) rotate(10deg); /* Counter rotate to lie flat */
}

/* --- CAKE TEXTURES --- */
.cake-texture {
    background-color: currentColor;
    background-image: 
        radial-gradient(rgba(0,0,0,0.15) 1px, transparent 1px),
        radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px);
    background-size: 3px 3px, 5px 5px;
    background-position: 0 0, 2px 2px;
}
.sprinkles {
    position: absolute; inset: 0; pointer-events: none;
    background-image: 
        radial-gradient(circle, #ffeb3b 2px, transparent 2.5px),
        radial-gradient(circle, #ff4081 2px, transparent 2.5px),
        radial-gradient(circle, #00e676 2px, transparent 2.5px),
        radial-gradient(circle, #2979ff 2px, transparent 2.5px);
    background-size: 60px 50px, 70px 80px, 50px 60px, 90px 40px;
    background-position: 10px 10px, 40px 20px, 20px 45px, 60px 5px;
    opacity: 0.8;
}

/* --- CAKE BASE --- */
.cake-base {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 80%; height: 80%;
    z-index: 10;
    transform-style: preserve-3d;
}
.cake-base-side {
    position: absolute; 
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: #4E342E;
    border-radius: 50%;
    box-shadow: 0 30px 60px rgba(0,0,0,0.6);
    background: linear-gradient(to right, #3E2723, #5D4037 40%, #5D4037 60%, #3E2723);
    /* Make the side thicker/deeper visual trick */
    transform: translateZ(-25px); 
}
/* Side Wall simulation (using multiple shadows/layers or just thick offset) 
   In CSS 2.5D, we simulate thickness by separating the top and bottom faces.
   Here cake-base-side is the BOTTOM face.
   cake-base-top is the TOP face.
*/
.cake-base-top {
    position: absolute; top: 0; left: 0;
    width: 100%; height: 100%;
    background: #5D4037;
    border-radius: 50%;
    box-shadow: inset 0 -5px 15px rgba(0,0,0,0.5);
    border-bottom: 1px solid #3E2723;
    transform: translateZ(25px); /* Lift top face */
}
/* Connect sides with a pseudo-element block? No, gradient on bottom usually suffices for this angle. 
   To make it look truly thick, we rely on the gap between base-side (bottom) and base-top (top).
*/

/* --- CAKE TOP --- */
.cake-top {
    position: absolute;
    top: 50%; left: 50%;
    width: 50%; height: 50%; 
    z-index: 20;
    transform-style: preserve-3d;
    transform: translate(-50%, -50%) translateZ(25px); /* Sit on top of base */
}
.cake-top-side {
    position: absolute; top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(to right, #F48FB1, #FCE4EC 40%, #FCE4EC 60%, #F48FB1);
    border-radius: 50%;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    /* Bottom of top tier */
    transform: translateZ(0px);
}
.cake-top-surface {
    position: absolute; top: 0; left: 0;
    width: 100%; height: 100%;
    background: #FFF3E0;
    border-radius: 50%;
    box-shadow: inset 0 0 20px rgba(255,224,178,0.5);
    border: 1px solid #FFE0B2;
    transform: translateZ(40px); /* Height of top tier */
    transform-style: preserve-3d; /* Important for children (candles) */
}
/* Frosting Drip */
.frosting-drip {
    position: absolute; top: -10px; left: -1%; width: 102%; height: 40px;
    background: radial-gradient(circle at 10px 0px, #FFF3E0 10px, transparent 11px) repeat-x top;
    background-size: 20px 20px;
    transform: translateZ(38px); /* Align with top */
}

/* --- TEXT & DECOR ON TOP --- */
/* Counter-rotate text so it looks painted on surface but readable? 
   No, user said "like my baby written on the cake". It should lie flat on the surface.
*/
.cake-text {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%) rotateX(0deg); /* Lies flat */
    font-family: 'Great Vibes', cursive;
    font-size: 2.5rem;
    color: #D81B60;
    text-shadow: 1px 1px 0px rgba(255,255,255,0.8);
    white-space: nowrap;
    z-index: 5;
    pointer-events: none;
}

/* Panda & Candles need to STAND UP.
   Since container is rotateX(25deg), we counter-rotate X(-25deg) to make them vertical.
*/
.panda-decoration {
    position: absolute;
    top: 30%; left: 50%;
    transform: translate(-50%, -50%) rotateX(-25deg); /* Stand up */
    width: 48px; height: 38px;
    background: #fff;
    border-radius: 50%;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    z-index: 30;
    border: 1px solid #f0f0f0;
}
/* Panda parts ... same as before */
.ear { position: absolute; top: -5px; width: 14px; height: 14px; background: #333; border-radius: 50%; z-index: -1; }
.ear.left { left: 0; }
.ear.right { right: 0; }
.panda-face { position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
.eyes { display: flex; gap: 4px; margin-top: 2px; }
.eye { width: 9px; height: 9px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
.pupil { width: 3px; height: 3px; background: #fff; border-radius: 50%; }
.nose { width: 6px; height: 4px; background: #333; border-radius: 10px; margin-top: 2px; }
.mouth { width: 8px; height: 3px; border-bottom: 2px solid #333; border-radius: 50%; }

/* --- HIGH QUALITY CANDLES --- */
.candle-wrapper {
    position: absolute;
    transform: translate(-50%, 0) rotateX(-25deg); /* Stand UP vertically */
    transform-origin: bottom center;
    cursor: pointer;
    z-index: 100;
}
.candle-stick {
    position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
    width: 10px; 
    border-radius: 3px;
    /* Subsurface scattering effect */
    box-shadow: 
        inset -2px 0 2px rgba(0,0,0,0.1),
        inset 2px 0 2px rgba(255,255,255,0.4),
        2px 2px 5px rgba(0,0,0,0.3);
}
.candle-stick::before {
    content: ''; position: absolute; inset: 0;
    background: repeating-linear-gradient(45deg, rgba(255,255,255,0.2) 0, rgba(255,255,255,0.2) 3px, transparent 3px, transparent 6px);
}

.wick {
    position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
    width: 2px; height: 8px; background: #222;
}

/* High Quality Flame */
.flame {
    position: absolute; bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%);
    width: 18px; height: 36px;
    /* Complex Gradient */
    background: radial-gradient(ellipse at bottom, 
        rgba(255,255,255,0.9) 0%, 
        rgba(255,241,118,0.8) 20%, 
        rgba(255,167,38,0.8) 50%, 
        rgba(255,87,34,0.6) 80%, 
        transparent 100%);
    border-radius: 50% 50% 20% 20%;
    /* Glow */
    filter: drop-shadow(0 0 8px rgba(255, 193, 7, 0.8)) drop-shadow(0 -5px 15px rgba(255, 87, 34, 0.4));
    transform-origin: center bottom;
    animation: flicker-chaotic 0.15s infinite alternate;
    transition: opacity 0.5s, transform 0.5s;
    opacity: 0.95;
    mix-blend-mode: screen; /* Brighter blending */
}
.flame-inner {
    position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%);
    width: 6px; height: 14px; background: rgba(33, 150, 243, 0.3); border-radius: 50%; filter: blur(2px);
}

@keyframes flicker-chaotic {
    0% { transform: translateX(-50%) scale(1.0) skewX(-2deg) scaleY(1.0); }
    25% { transform: translateX(-50%) scale(1.05) skewX(2deg) scaleY(1.02); }
    50% { transform: translateX(-50%) scale(0.95) skewX(-1deg) scaleY(0.98); }
    75% { transform: translateX(-50%) scale(1.02) skewX(3deg) scaleY(1.05); }
    100% { transform: translateX(-50%) scale(1.0) skewX(1deg) scaleY(1.0); }
}

.flame.extinguished {
    transform: translateX(-50%) scale(0);
    opacity: 0;
}

.smoke {
    position: absolute; bottom: calc(100% + 12px); left: 50%;
    width: 10px; height: 10px;
    background: rgba(220,220,220,0.5);
    border-radius: 50%;
    filter: blur(5px);
    animation: smoke-rise 2.5s ease-out forwards;
    pointer-events: none;
}
@keyframes smoke-rise {
    0% { transform: translate(-50%, 0) scale(1); opacity: 0.6; }
    100% { transform: translate(-50%, -80px) scale(5); opacity: 0; }
}

.cherry {
    position: absolute;
    width: 24px; height: 24px;
    background: radial-gradient(circle at 35% 35%, #ff5252, #b71c1c);
    border-radius: 50%;
    box-shadow: 2px 4px 6px rgba(0,0,0,0.3);
    z-index: 20;
    /* Stand Up */
    transform: translate(-50%, -50%) rotateX(-25deg);
}
.cherry::after { content: ''; position: absolute; top: 4px; left: 5px; width: 6px; height: 4px; background: rgba(255,255,255,0.5); border-radius: 50%; filter: blur(1px); }
.cherry::before { content: ''; position: absolute; bottom: 85%; left: 50%; width: 14px; height: 12px; border-left: 2px solid #689f38; border-radius: 50%; transform: rotate(-20deg); }
