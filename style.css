/* Reset */
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    font-family: 'Quicksand', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #000;
}

/* --- Room Environment --- */
.room {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    z-index: 0;
}

.wall {
    height: 70%;
    width: 100%;
    background: radial-gradient(circle at center, #d88df0 0%, #b86ce0 100%);
    /* Simple CSS Heart Pattern */
    background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50 85 C20 60 5 45 5 30 C5 15 20 5 35 5 C43 5 50 15 50 15 C50 15 57 5 65 5 C80 5 95 15 95 30 C95 45 80 60 50 85' fill='%23a55bd0' opacity='0.2'/%3E%3C/svg%3E");
}

.floor {
    height: 30%;
    width: 100%;
    background: radial-gradient(ellipse at center top, #ffc9e6 0%, #ff9ec7 70%);
}

/* --- Curtains --- */
.curtain {
    position: absolute;
    top: 0; bottom: 0;
    width: 150px;
    background: repeating-linear-gradient(90deg, #d32f2f, #b71c1c 20px, #d32f2f 40px);
    box-shadow: 10px 0 20px rgba(0,0,0,0.5);
    z-index: 50;
}
.curtain.left { left: 0; border-right: 2px solid #9a1010; }
.curtain.right { right: 0; border-left: 2px solid #9a1010; }

.rope {
    position: absolute;
    top: 50%;
    width: 20px;
    height: 60px;
    background: #e6c200; /* Gold */
    border-radius: 10px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
}
.curtain.left .rope { right: -10px; }
.curtain.right .rope { left: -10px; }

/* --- Bunting --- */
.bunting {
    position: absolute;
    top: 0; left: 150px; right: 150px;
    height: 60px;
    display: flex;
    justify-content: space-between;
    z-index: 40;
    pointer-events: none;
}
.flag {
    width: 0; height: 0;
    border-left: 30px solid transparent;
    border-right: 30px solid transparent;
    border-top: 50px solid var(--f-color);
    filter: drop-shadow(0 5px 5px rgba(0,0,0,0.1));
    transform-origin: top center;
    animation: swing 3s ease-in-out infinite;
    animation-delay: var(--delay);
}
@keyframes swing { 0%,100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }

/* --- UI Overlays --- */
#start-overlay {
    position: fixed; inset: 0;
    background: rgba(255,255,255,0.85);
    z-index: 1000;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: opacity 0.5s;
}
#start-overlay.hidden { opacity: 0; pointer-events: none; }
.content { text-align: center; }
#start-btn {
    margin-top: 20px;
    padding: 15px 40px;
    font-size: 1.5rem;
    background: #ff4081;
    color: white;
    border: none;
    border-radius: 50px;
    font-family: 'Fredoka One', cursive;
    cursor: pointer;
    box-shadow: 0 5px 0 #c2185b;
    transition: transform 0.1s;
}
#start-btn:active { transform: translateY(5px); box-shadow: 0 0 0 transparent; }

#mic-indicator {
    position: absolute; top: 80px; left: 50%;
    transform: translateX(-50%);
    background: white; padding: 8px 15px;
    border-radius: 20px;
    display: flex; gap: 10px; align-items: center;
    z-index: 200;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
#mic-indicator.hidden { display: none; }
.bar-bg { width: 100px; height: 10px; background: #ddd; border-radius: 5px; overflow: hidden; }
#mic-level-bar { width: 0%; height: 100%; background: #4caf50; transition: width 0.1s; }

/* --- The Stage & Cake --- */
.stage {
    position: relative;
    width: 600px; height: 500px;
    z-index: 10;
    margin-top: 100px;
    /* Scale down for mobile */
}

/* Plate */
.plate {
    position: absolute;
    bottom: 20px; left: 50%;
    width: 550px; height: 200px;
    transform: translateX(-50%);
    background: #4dd0e1;
    border-radius: 50%;
    box-shadow: 0 10px 0 #0097a7, 0 20px 20px rgba(0,0,0,0.2);
    z-index: 1;
}

.cake-group {
    position: absolute;
    bottom: 60px; left: 50%;
    width: 440px; height: 250px;
    transform: translateX(-50%);
    z-index: 2;
}

/* Chocolate Base */
.cake-base {
    position: absolute;
    bottom: 0; left: 0; width: 100%; height: 120px;
    background: #8b5a2b; /* Chocolate */
    border-radius: 50% 50% 50% 50% / 0% 0% 30% 30%; /* Curved bottom */
    box-shadow: inset -10px 0 20px rgba(0,0,0,0.3);
    z-index: 2;
}
/* This pseudo element makes the bottom 3D thickness */
.cake-base::after {
    content: ''; position: absolute;
    bottom: 0; left: 0; width: 100%; height: 60px;
    background: inherit;
    border-radius: 50%;
    z-index: -1;
}

/* White Icing Body */
.cake-icing-body {
    position: absolute;
    top: 20px; left: 0; width: 100%; height: 160px;
    background: #fff8e7; /* Creamy white */
    border-radius: 50%; /* Just curve sides initially */
    z-index: 3;
    display: flex; justify-content: center; align-items: center;
}

/* The Wavy Bottom Effect */
.scallop-mask {
    position: absolute;
    bottom: -15px; left: 0; width: 100%; height: 40px;
    background: radial-gradient(circle at 50% 100%, #fff8e7 65%, transparent 66%);
    background-size: 88px 40px; /* Adjust size for wave count */
    background-repeat: repeat-x;
    transform: rotate(180deg); /* Flip to make scallop point down */
}

/* Text on Cake */
.text-label {
    font-family: 'Fredoka One', cursive;
    font-size: 3rem;
    color: #3f51b5; /* Blue text */
    z-index: 10;
    margin-top: 40px;
    transform: rotateX(10deg); /* Perspective fix */
    text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
    letter-spacing: 1px;
}

/* Top Surface */
.cake-top {
    position: absolute;
    top: 20px; left: 0; width: 100%; height: 110px;
    background: #fffbf0;
    border-radius: 50%;
    border: 1px solid #f0ebdb;
    z-index: 5;
    box-shadow: inset 0 0 30px rgba(0,0,0,0.05);
}

/* Top Sprinkles */
.sprinkles-top {
    width: 100%; height: 100%;
    background-image: radial-gradient(#8b5a2b 1.5px, transparent 1.5px);
    background-size: 15px 15px;
    border-radius: 50%;
    opacity: 0.6;
}

/* --- Decorations --- */
.candle {
    position: absolute;
    width: 10px; height: 70px;
    background: repeating-linear-gradient(45deg, var(--c1), var(--c1) 5px, var(--c2) 5px, var(--c2) 10px);
    border-radius: 3px;
    box-shadow: 2px 2px 2px rgba(0,0,0,0.2);
    z-index: 20;
    transform-origin: bottom center;
}
.flame {
    position: absolute; top: -15px; left: 50%;
    width: 10px; height: 15px;
    background: #ff9800;
    border-radius: 50% 50% 20% 20%;
    transform: translateX(-50%);
    box-shadow: 0 0 10px #ffeb3b;
    animation: flicker 0.1s infinite alternate;
}
.flame.out { display: none; }
@keyframes flicker { 0% { transform: translateX(-50%) scale(1); } 100% { transform: translateX(-50%) scale(0.9, 1.1); } }

.smoke {
    position: absolute; top: -20px; left: 50%;
    width: 5px; height: 5px; background: #aaa;
    border-radius: 50%;
    animation: smoke 1s forwards;
}
@keyframes smoke { to { transform: translate(-50%, -30px) scale(3); opacity: 0; } }

.truffle {
    position: absolute;
    width: 30px; height: 26px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #5d4037, #3e2723);
    box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
    z-index: 15;
}
.truffle.white {
    background: radial-gradient(circle at 30% 30%, #fffde7, #f57f17); /* Yellowish/White */
}
/* Drizzle CSS */
.truffle::after {
    content: ''; position: absolute; top: 2px; left: 5px;
    width: 20px; height: 10px;
    border-top: 2px solid rgba(255,255,255,0.5);
    border-radius: 50%;
    transform: rotate(-10deg);
}

.macaron {
    position: absolute;
    width: 35px; height: 20px;
    background: var(--mc);
    border-radius: 10px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    border-bottom: 3px solid rgba(0,0,0,0.1); /* Filling look */
    z-index: 15;
}

/* --- Balloons --- */
.balloons-container {
    position: absolute;
    bottom: -20px; width: 100%;
    display: flex; justify-content: space-between;
    pointer-events: none;
    z-index: 30;
    padding: 0 50px;
}
.balloon {
    width: 60px; height: 75px;
    border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
    box-shadow: inset -5px -5px 10px rgba(0,0,0,0.1);
    position: relative;
    opacity: 0.9;
}
.balloon::after {
    content: ''; position: absolute; bottom: -5px; left: 50%;
    transform: translateX(-50%);
    width: 0; height: 0;
    border-left: 5px solid transparent; border-right: 5px solid transparent;
    border-top: 8px solid inherit;
}
.b-yellow { background: #ffd54f; top: -20px; border-top-color: #ffd54f; }
.b-red { background: #e57373; top: 40px; border-top-color: #e57373; }
.b-blue { background: #64b5f6; top: -10px; border-top-color: #64b5f6; }

/* Message */
#message {
    position: absolute; top: 40%; left: 50%;
    transform: translate(-50%, -50%);
    background: white; padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    z-index: 100;
}
#message.hidden { display: none; }
#message h2 { color: #d81b60; font-family: 'Fredoka One'; font-size: 2.5rem; }

#confetti-canvas { position: fixed; inset: 0; pointer-events: none; z-index: 200; }

@media (max-width: 600px) {
    .stage { transform: scale(0.6); margin-top: 0; }
    .curtain { width: 60px; }
}