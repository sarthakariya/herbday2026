/* --- GLOBAL --- */
body {
    background: radial-gradient(circle at center, #2e0810 0%, #0f0204 100%);
    margin: 0;
    overflow: hidden;
    font-family: 'Montserrat', sans-serif;
}

/* --- UTILITIES --- */
.perspective-1000 { perspective: 1000px; }
.transform-style-3d { transform-style: preserve-3d; }
.backface-hidden { backface-visibility: hidden; }

/* --- LIGHTING --- */
.spotlight {
    position: absolute;
    top: -50%;
    left: 50%;
    transform: translateX(-50%);
    width: 100vw;
    height: 100vh;
    background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, rgba(0,0,0,0) 65%);
    pointer-events: none;
    z-index: 5;
    mix-blend-mode: screen;
}

/* --- CURTAINS --- */
.curtain {
    transition: transform 3.0s cubic-bezier(0.25, 1, 0.5, 1);
}
.curtain-open-left { transform: translateX(-100%) skewX(5deg); }
.curtain-open-right { transform: translateX(100%) skewX(-5deg); }

/* --- 3D SCENE SETUP --- */
.scene-container {
    transform-style: preserve-3d;
    width: 320px;
    height: 320px;
    /* Rotation controlled in HTML style for dynamic feel, usually rotateX(20deg) */
    transition: transform 1s ease-out;
}

/* --- TABLE SURFACE --- */
/* Positioned relative to the scene container */
.wood-table-surface {
    position: absolute;
    top: 50%; left: 50%;
    width: 200vw; height: 200vh;
    background: #3e2723 url('https://www.transparenttextures.com/patterns/wood-pattern.png');
    /* Push it down so the cake sits ON it */
    transform: translate(-50%, -50%) translateZ(-50px); 
    box-shadow: inset 0 0 150px rgba(0,0,0,0.9);
    z-index: 0; /* Behind cake */
}
.table-reflection {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 400px; height: 400px;
    background: radial-gradient(rgba(255,255,255,0.08), transparent 70%);
    filter: blur(40px);
}

/* --- CAKE ASSEMBLY --- */
.cake-assembly {
    position: relative;
    width: 100%; height: 100%;
    transform-style: preserve-3d;
    z-index: 20;
}

/* --- PLATE --- */
.plate {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%) translateZ(-10px);
    width: 130%; height: 130%;
    border-radius: 50%;
    background: #fff;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 0 20px rgba(0,0,0,0.1);
    border: 1px solid #ddd;
}
.plate-inner {
    position: absolute; inset: 12px; border-radius: 50%;
    border: 4px solid #FFC107;
    box-shadow: 0 0 15px rgba(255, 193, 7, 0.4);
}

/* --- CAKE LAYERS --- */
.cake-layer {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    transform-style: preserve-3d;
}
.layer-side {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    border-radius: 50%;
}
.layer-top {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    border-radius: 50%;
}

/* Base Layer (Chocolate) - Taller for side view */
.base-layer { width: 100%; height: 100%; transform: translate(-50%, -50%) translateZ(0px); }
.base-layer .layer-side {
    background: linear-gradient(to right, #3E2723, #4E342E 25%, #5D4037 50%, #4E342E 75%, #3E2723);
    transform: translateZ(-45px); /* Thickness */
    box-shadow: 0 10px 40px rgba(0,0,0,0.6); /* Drop shadow on table */
}
.base-layer .layer-top {
    background: radial-gradient(circle, #5D4037 20%, #3E2723 100%);
    transform: translateZ(0px);
    border: 1px solid #3E2723;
}

/* Top Layer (Pink) */
.top-layer { width: 75%; height: 75%; transform: translate(-50%, -50%) translateZ(45px); }
.top-layer .layer-side {
    background: linear-gradient(to right, #ec407a, #f48fb1 25%, #f8bbd0 50%, #f48fb1 75%, #ec407a);
    transform: translateZ(-40px);
}
.top-layer .layer-top {
    background: radial-gradient(circle at 30% 30%, #fff3e0 0%, #ffcc80 100%);
    transform: translateZ(0px);
    box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
    border: 1px solid #ffb74d;
}
.frosting-drip {
    position: absolute; top: -5px; left: 0; width: 100%; height: 25px;
    background: repeating-linear-gradient(45deg, rgba(255,255,255,0.4), rgba(255,255,255,0.4) 10px, transparent 10px, transparent 20px);
    opacity: 0.6;
    border-radius: 50%;
    filter: blur(1px);
}

/* --- DECORATIONS --- */
.cake-writing {
    position: absolute; top: 50%; left: 50%;
    /* Counter-rotate X to stand up relative to the layer */
    transform: translate(-50%, -50%) rotateX(-20deg) translateY(30px) translateZ(5px); 
    font-family: 'Great Vibes', cursive;
    font-size: 3.5rem;
    color: #c2185b;
    text-shadow: 1px 1px 0 rgba(255,255,255,0.6), 0 0 8px rgba(233,30,99,0.4);
    white-space: nowrap;
    pointer-events: none;
}

/* Panda */
.panda-container {
    position: absolute; top: 25%; left: 50%;
    transform: translate(-50%, -50%) rotateX(-20deg); /* Match camera angle counter-rotation */
    z-index: 50;
}
.panda-body {
    width: 60px; height: 50px;
    background: #fff; border-radius: 45% 45% 40% 40%;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    position: relative;
    border: 1px solid #f5f5f5;
    animation: bob 3s ease-in-out infinite;
}
.ear { position: absolute; top: -10px; width: 20px; height: 20px; background: #222; border-radius: 50%; z-index: -1; }
.ear.left { left: 0; }
.ear.right { right: 0; }
.face { position: relative; width: 100%; height: 100%; }
.eye { position: absolute; top: 15px; width: 16px; height: 16px; background: #222; border-radius: 50%; overflow: hidden; }
.eye.left { left: 10px; }
.eye.right { right: 10px; }
.pupil { width: 6px; height: 6px; background: #fff; border-radius: 50%; margin: 3px; animation: blink 4s infinite; }
.nose { position: absolute; top: 28px; left: 50%; transform: translateX(-50%); width: 10px; height: 6px; background: #222; border-radius: 40%; }
.mouth { position: absolute; top: 36px; left: 50%; transform: translateX(-50%); width: 12px; height: 5px; border-bottom: 2px solid #222; border-radius: 50%; }
.cheek { position: absolute; top: 28px; width: 10px; height: 6px; background: #ffcdd2; border-radius: 50%; opacity: 0.6; }
.cheek.left { left: 2px; }
.cheek.right { right: 2px; }

/* Candles */
.candle-wrapper {
    position: absolute;
    transform-origin: bottom center;
    transform: translate(-50%, 0) rotateX(-20deg); /* Stand up straight against the camera tilt */
    z-index: 100;
}
.candle-stick {
    position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
    width: 8px; border-radius: 2px;
    box-shadow: 1px 1px 4px rgba(0,0,0,0.3);
}
.candle-stick::before { 
    content: ''; position: absolute; inset: 0;
    background: repeating-linear-gradient(45deg, rgba(255,255,255,0.4) 0, rgba(255,255,255,0.4) 3px, transparent 3px, transparent 6px);
}
.wick {
    position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
    width: 2px; height: 7px; background: #333;
    transition: background-color 0.2s;
}

/* Flames */
.flame-3d {
    position: absolute; bottom: calc(100% + 7px); left: 50%;
    width: 14px; height: 32px;
    transform-style: preserve-3d;
    transform: translateX(-50%);
    transition: all 0.2s ease-out;
}
.flame-plane {
    position: absolute; bottom: 0; left: 0; width: 100%; height: 100%;
    background: radial-gradient(ellipse at bottom, #fff 10%, #ffeb3b 40%, #ff9800 80%, transparent 100%);
    border-radius: 50% 50% 20% 20%;
    box-shadow: 0 0 15px #ff9800;
    animation: flicker 0.1s infinite alternate;
}
.flame-plane:nth-child(2) { transform: rotateY(90deg); }

@keyframes flicker {
    0% { transform: rotateY(var(--ry)) scale(1); opacity: 0.9; }
    100% { transform: rotateY(var(--ry)) scale(1.05); opacity: 1; }
}

.flame-3d.out { transform: translateX(-50%) scale(0.1); opacity: 0; }
.candle-wrapper.extinguished .wick { animation: wick-glow 1.5s ease-out forwards; }
@keyframes wick-glow {
    0% { background-color: #ff3d00; box-shadow: 0 0 6px #ff1744; }
    30% { background-color: #ff9100; box-shadow: 0 0 4px #ff6d00; }
    100% { background-color: #222; box-shadow: none; }
}

/* Smoke */
.smoke {
    position: absolute; bottom: calc(100% + 15px); left: 50%;
    width: 8px; height: 8px; background: rgba(255,255,255,0.5);
    border-radius: 50%; filter: blur(3px);
    animation: smoke-rise 2s ease-out forwards;
}
@keyframes smoke-rise {
    0% { transform: translate(-50%, 0) scale(1); opacity: 0.6; }
    100% { transform: translate(-50%, -80px) scale(4); opacity: 0; }
}

/* Gifts */
.gift-box {
    position: absolute;
    top: 50%; left: 50%;
    width: 60px; height: 60px;
    transform-style: preserve-3d;
    transform: translate3d(var(--x), var(--z), 0) rotateZ(var(--rot)) rotateX(-90deg);
    z-index: 15;
}
.gift-box::before { /* Top */
    content: ''; position: absolute; inset: 0;
    background: var(--color);
    box-shadow: inset 0 0 15px rgba(0,0,0,0.3);
    transform: translateZ(40px); /* Height of box */
}
.gift-box::after { /* Side Shadow Mockup */
    content: ''; position: absolute; top: 100%; left: 0; width: 100%; height: 40px;
    background-color: var(--color);
    filter: brightness(0.7);
    transform-origin: top;
    transform: rotateX(-90deg);
}
.gift-lid {
    position: absolute; inset: -3px;
    background: rgba(255,255,255,0.15);
    transform: translateZ(42px);
    border: 1px solid rgba(255,255,255,0.3);
}
.gift-ribbon {
    position: absolute; inset: 0;
    background: 
        linear-gradient(90deg, transparent 40%, #FFD700 40%, #FFD700 60%, transparent 60%),
        linear-gradient(0deg, transparent 40%, #FFD700 40%, #FFD700 60%, transparent 60%);
    transform: translateZ(43px);
}

/* Card Transitions */
.card-inner.open { transform: rotateY(-180deg); }

/* Animation Utils */
@keyframes bob { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
@keyframes blink { 0%, 95% { transform: scaleY(1); } 98% { transform: scaleY(0.1); } }
.balloon { position: absolute; z-index: 1; }
